# סיכום מקרי בדיקה למערכת עץ מרקל

קובץ זה מסביר את כל מקרי הבדיקה שרצו על התוכנית ex1.py. כל בדיקה מופיעה בקובץ test_output.txt עם הקלט שנשלח לתוכנית והפלט שהתקבל.

## מהו עץ מרקל?
עץ מרקל (Merkle Tree) הוא מבנה נתונים קריפטוגרפי המאפשר אחסון יעיל של נתונים עם יכולת להוכיח שנתון מסוים נמצא בעץ. העץ בנוי מהאשים (hashes) של הנתונים, כאשר כל צומת פנימי מכיל את ההאש של שני הילדים שלו. השורש של העץ מייצג את כל הנתונים בצורה מרוכזת.

## מבנה הפלט
כל בדיקה מופיעה בפורמט הבא:
- כותרת עם שם הבדיקה
- קלט (INPUT) - הפקודות שנשלחו לתוכנית
- פלט (OUTPUT) - התוצאות שהתקבלו

## דוגמה למראה בדיקה בקובץ
```
############################################################
# Starting Test: test_single_leaf_root
############################################################

============================================================
Test Execution #48
Timestamp: 2025-05-29 12:39:37
============================================================

INPUT TO ex1.py:
----------------------------------------
  1: 1 a
  2: 2
----------------------------------------

OUTPUT FROM ex1.py:
----------------------------------------
  1: ca978112ca1bbdcafac231b39a23dc4da786eff8147c4e72b9807785afee48bb
----------------------------------------
```

בדוגמה זו:
- שורה 1 בקלט: הכנסת העלה "a" לעץ
- שורה 2 בקלט: בקשה לחשב את שורש העץ
- הפלט: השורש המחושב (ערך SHA256 של "a")

## הפקודות הזמינות
1. `1 <data>` - הכנסת עלה חדש לעץ
2. `2` - חישוב והדפסת שורש העץ הנוכחי
3. `3 <index>` - יצירת הוכחה למיקום מסוים
4. `4 <data> <root> <proof_items...>` - אימות הוכחה
5. `5` - יצירת זוג מפתחות RSA
6. `6 <private_key>` - חתימה על שורש העץ
7. `7 <public_key> <signature> <root>` - אימות חתימה

## משמעות הפלטים
- **פקודה 1:** אין פלט (שורה ריקה)
- **פקודה 2:** מחרוזת של 64 תווים הקסדצימליים - שורש העץ
- **פקודה 3:** שורש העץ ואחריו רשימת פריטי הוכחה (כל פריט מתחיל ב-0/1 לציון כיוון)
- **פקודה 4:** "True" או "False" - תוצאת האימות. שורה ריקה אם השורש או פריטי ההוכחה לא תקינים
- **פקודה 5:** מפתח פרטי RSA ומפתח ציבורי בפורמט PEM
- **פקודה 6:** חתימה בקידוד Base64
- **פקודה 7:** "True" או "False" - תוצאת אימות החתימה. שורה ריקה אם החתימה לא בפורמט Base64 תקין
- **שורה ריקה:** מציינת שגיאה או פקודה לא תקינה

## מקרי הבדיקה

**הערה:** המספרים בסוגריים (למשל "הרצות: 1-3") מציינים את מספרי ההרצות בקובץ test_output.txt. כל בדיקה יכולה לכלול מספר הרצות כדי לבדוק תרחישים שונים.

### 1. test_incremental_roots
**מטרה:** בדיקה שאחרי כל הכנסת עלה, השורש מחושב נכון.

**הרצות:** 1
- מכניסים 5 עלים (apple, banana, cherry, date, elderberry)
- אחרי כל הכנסה מבקשים את השורש
- מוודאים שכל שורש מחושב נכון

### 2. test_invalid_commands
**מטרה:** בדיקת טיפול בפקודות לא תקינות.

**הרצות:** 2
- שולחים פקודות לא תקינות: "invalid", "1" (בלי נתונים), "3 5" (אינדקס לא קיים), "4 a b c" (b אינו הקס תקין)
- מצפים לקבל שורות ריקות

### 3. test_long_input_handled
**מטרה:** בדיקת טיפול במחרוזות ארוכות מאוד.

**הרצות:** 3
- מכניסים מחרוזת של 2048 תווי 'x'
- מוודאים שהתוכנית מטפלת בזה ומחזירה שורש תקין (64 תווים)

### 4. test_malformed_proof_items
**מטרה:** בדיקת דחיית הוכחות לא תקינות.

**הרצות:** 4-10
- יוצרים עץ עם 2 עלים
- יוצרים הוכחה תקינה
- בודקים מקרים של הוכחות פגומות:
  - הוכחה ריקה (לא תקינה לעץ עם 2 עלים, אך תקינה לעץ עם עלה בודד)
  - חסר bit כיוון
  - bit כיוון לא תקין (2)
  - הוכחה קצוצה
  - תווים נוספים
  - תווים לא הקסדצימליים
- כל המקרים מחזירים שורה ריקה (במקום False)

### 5. test_multiple_leaves_root
**מטרה:** בדיקת חישוב שורש עם מספר עלים.

**הרצות:** 11
- מכניסים 5 עלים (a, b, c, d, e)
- מבקשים את השורש
- מוודאים שהוא מחושב נכון

### 6. test_proof_and_verify_failure
**מטרה:** בדיקת כישלון אימות כשההוכחה שונתה.

**הרצות:** 12-13
- יוצרים עץ עם 3 עלים (k, l, m)
- יוצרים הוכחה לעלה הראשון
- משנים את bit הכיוון בהוכחה
- מוודאים שהאימות נכשל (False)

### 7. test_proof_and_verify_success
**מטרה:** בדיקת הצלחת אימות הוכחה תקינה.

**הרצות:** 14-15
- יוצרים עץ עם 3 עלים (x, y, z)
- יוצרים הוכחה לעלה האמצעי
- מאמתים את ההוכחה
- מצפים לקבל True

### 8. test_proof_invalid_root
**מטרה:** בדיקת אימות עם שורש שגוי.

**הרצות:** 16-17
- יוצרים עץ עם 3 עלים (red, green, blue)
- יוצרים הוכחה תקינה
- מנסים לאמת עם שורש של אפסים
- מצפים לקבל False

### 9. test_proof_length_power_of_two
**מטרה:** בדיקה שאורך ההוכחה שווה ל-log2(n) בעצים בגודל חזקת 2.

**הרצות:** 18-22
- בודקים עצים בגדלים: 2, 4, 8, 16, 32 עלים
- מוודאים שאורך ההוכחה הוא הלוגריתם של מספר העלים

### 10. test_random_leaf_proofs_large_tree
**מטרה:** בדיקת הוכחות עבור עלים אקראיים בעץ גדול.

**הרצות:** 23-33
- יוצרים עץ עם 50 עלים
- בוחרים 10 מיקומים אקראיים
- יוצרים הוכחות ומאמתים אותן
- כל האימותים צריכים להחזיר True

### 11. test_rsa_sign_and_verify
**מטרה:** בדיקת חתימה דיגיטלית ואימותה.

**הרצות:** 34-36
- יוצרים זוג מפתחות RSA
- בונים עץ עם 2 עלים
- חותמים על השורש עם המפתח הפרטי
- מאמתים את החתימה עם המפתח הציבורי
- מצפים לקבל True

### 12. test_sign_invalid_key_prefix
**מטרה:** בדיקת חתימה עם תחילת מפתח לא תקינה.

**הרצות:** 37
- מנסים לחתום עם מפתח שמתחיל ב-"BEGIN INVALID KEY"
- מצפים לקבל שורה ריקה

### 13. test_sign_invalid_key_suffix
**מטרה:** בדיקת חתימה עם סיום מפתח לא תקין.

**הרצות:** 38
- מנסים לחתום עם מפתח שמסתיים ב-"END INVALID KEY"
- מצפים לקבל שורה ריקה

### 14. test_sign_valid_markers_invalid_content
**מטרה:** בדיקת חתימה עם מפתח בעל סימנים תקינים אך תוכן לא תקין.

**הרצות:** 39
- מנסים לחתום עם מפתח שיש לו תגיות BEGIN/END תקינות אך תוכן לא תקין
- מצפים לקבל שורה ריקה

### 15. test_signature_invalid_after_tree_change
**מטרה:** בדיקה שחתימה על שורש ישן לא תקפה לשורש חדש.

**הרצות:** 40-43
- יוצרים עץ עם 2 עלים וחותמים על השורש
- מוסיפים עלה שלישי
- מוודאים שהחתימה עדיין תקפה לשורש הישן (True)
- מוודאים שהחתימה לא תקפה לשורש החדש (False)

### 16. test_signature_wrong_public_key
**מטרה:** בדיקת אימות חתימה עם מפתח ציבורי שגוי.

**הרצות:** 44-47
- יוצרים 2 זוגות מפתחות שונים
- חותמים עם מפתח פרטי אחד
- מנסים לאמת עם מפתח ציבורי של הזוג השני
- מצפים לקבל False

### 17. test_single_leaf_root
**מטרה:** בדיקת שורש של עץ עם עלה בודד.

**הרצות:** 48
- מכניסים עלה בודד "a"
- מבקשים את השורש
- מוודאים שהוא ה-SHA256 של "a"

### 18. test_single_leaf_proof_and_verify
**מטרה:** בדיקת הוכחה ואימות עבור עץ עם עלה בודד.

**הרצות:** 49
- מכניסים עלה בודד "single"
- יוצרים הוכחה לעלה (צריכה להיות ריקה)
- מוודאים שההוכחה ריקה
- מאמתים עם הוכחה ריקה - צריך להצליח (True)
- מאמתים עם נתונים שגויים - צריך להיכשל (False)

### 19. test_various_proof_positions
**מטרה:** בדיקת הוכחות במיקומים שונים בעץ.

**הרצות:** 50-55
- יוצרים עץ עם 8 עלים
- בודקים הוכחות עבור:
  - העלה הראשון (אינדקס 0)
  - עלה אמצעי (אינדקס 4)
  - העלה האחרון (אינדקס 7)
- כל ההוכחות צריכות להיות תקינות

### 20. test_verify_invalid_base64_signature
**מטרה:** בדיקת אימות עם חתימה לא תקינה ב-Base64.

**הרצות:** 56-57
- מנסים לאמת חתימה עם מחרוזת שאינה Base64 תקין
- מצפים לקבל שורה ריקה

### 21. test_verify_invalid_key_prefix
**מטרה:** בדיקת אימות עם תחילת מפתח לא תקינה.

**הרצות:** 58
- מנסים לאמת עם מפתח שמתחיל ב-"BEGIN INVALID KEY"
- מצפים לקבל שורה ריקה

### 22. test_verify_invalid_key_suffix
**מטרה:** בדיקת אימות עם סיום מפתח לא תקין.

**הרצות:** 59
- מנסים לאמת עם מפתח שמסתיים ב-"END INVALID KEY"
- מצפים לקבל שורה ריקה

### 23. test_verify_valid_markers_invalid_content
**מטרה:** בדיקת אימות עם מפתח בעל סימנים תקינים אך תוכן לא תקין.

**הרצות:** 60
- מנסים לאמת עם מפתח שיש לו תגיות BEGIN/END תקינות אך תוכן לא תקין
- מצפים לקבל False

## סיכום
כל 23 הבדיקות עברו בהצלחה (0 כשלונות, 0 שגיאות).
הבדיקות מכסות את כל הפונקציונליות של המערכת כולל מקרי קצה וטיפול בשגיאות. 